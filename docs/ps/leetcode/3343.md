---
title: '3343 - Count Number of Balanced Permutations'
eng_title: '3343 - Count Number of Balanced Permutations'
image: https://til.qriosity.dev/img/m_banner_background.jpg
sidebar_label: '3343 - Count Number of Balanced Permutations'
sidebar_position: 3343
created_date: 2025-05-09
updated_date: 2025-05-12
---

# 3343 - Count Number of Balanced Permutations

:::info

- **ë¬¸ì œ ë³´ê¸°**: [3343 - Count Number of Balanced Permutations](https://leetcode.com/problems/count-number-of-balanced-permutations)
- **ì†Œìš” ì‹œê°„**: ğŸ’¥**1ì‹œê°„ ì´ˆê³¼**
- **í’€ì´ ì–¸ì–´**: `java`
- **ì²´ê° ë‚œì´ë„**: 5ï¸âƒ£
- **ë¦¬ë·° íšŸìˆ˜**: âœ…

:::

<br />

### í’€ì´ í‚¤ì›Œë“œ

<details>
<summary>ìŠ¤í¬ì£¼ì˜</summary>

`DP` `ìˆ˜í•™` `ì¡°í•©ë¡ `

</details>

<br />

### í’€ì´ ì½”ë“œ

:::info

- **ë©”ëª¨ë¦¬**: 45300 KB
- **ì‹œê°„**: 96 ms

:::

```java
class Solution {
    final int MOD = 1_000_000_007;
    int[] cnt = new int[10];
    long[] fact = new long[81];
    long[] inv = new long[81];
    long[] invFact = new long[81];
    int n, evenLen, oddLen, halfSum;
    int[][][] memo;

    private long dp(int i, int depth, int curSum) { // i: current digit | depth: length of selected
        if (curSum > halfSum || depth > evenLen) return 0;
        if (i > 9) return (depth == evenLen && curSum == halfSum) ? 1 : 0;
        if (memo[i][depth][curSum] != -1) return memo[i][depth][curSum];

        long res = 0;
        for (int use = 0; use <= cnt[i] && depth+use <= evenLen && curSum+i*use <= halfSum; ++use) {
            long evenPerm = fact[depth+use] * invFact[depth] % MOD * invFact[use] % MOD;
            long oddInv = invFact[cnt[i]-use]; // ì•ˆì“´ë§Œí¼ í™€ìˆ˜ ì¸ë±ìŠ¤ë¡œ ê° -> í™€ìˆ˜ ì¸ë±ìŠ¤ ë°°ì¹˜ ìˆ˜ì‹ì˜ ë¶„ëª¨
            res = (res + (evenPerm * oddInv % MOD) * dp(i+1, depth+use, curSum+i*use)) % MOD;
        }

        memo[i][depth][curSum] = (int) res;
        return res;
    }

    public int countBalancedPermutations(String num) {
        n = num.length();
        int totalSum = 0;
        for (char ch : num.toCharArray()) {
            totalSum += ch - '0';
            ++cnt[ch-'0'];
        }
        if ((totalSum & 1) == 1) return 0; // can't satisfy condition

        halfSum = totalSum / 2;
        evenLen = (n+1) / 2;
        oddLen = n - evenLen;
        memo = new int[10][evenLen+1][halfSum+1];
        for (int i = 0; i < 10; ++i)
            for (int j = 0; j <= evenLen; ++j)
                Arrays.fill(memo[i][j], -1);
        
        precalc();
        long res = dp(0, 0, 0);
        // í™€ìˆ˜ ì¸ë±ìŠ¤ ë°°ì¹˜ ìˆ˜ì‹ì˜ ë¶„ì ê³±í•˜ê¸°
        res = res * fact[oddLen] % MOD;
        return (int) res;
    }

    public void precalc() {
        fact[0] = inv[0] = invFact[0] = 1;
        for (int i = 1; i < 81; ++i) fact[i] = fact[i-1] * i % MOD;
        inv[1] = 1; // extended euclidean
        for (int i = 2; i < 81; ++i) inv[i] = MOD - (MOD/i) * inv[MOD%i] % MOD;
        for (int i = 1; i < 81; ++i) invFact[i] = invFact[i-1] * inv[i] % MOD;
    }
}
```

<br />

### í’€ì´ í•´ì„¤

ì£¼ì–´ì§„ ë¬¸ìì—´ì˜ ìˆ«ìë¥¼ ë’¤ì„ì–´ì„œ í™€ìˆ˜ ì¸ë±ìŠ¤ í•©, ì§ìˆ˜ ì¸ë±ìŠ¤ í•©ì´ ê°™ë„ë¡ í•˜ëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ ì„¸ëŠ” ë¬¸ì œì´ë‹¤.

ê²½ìš°ì˜ ìˆ˜ê°€ ë§¤ìš° ë§ì„ ìˆ˜ ìˆì–´ ëª¨ë“ˆëŸ¬ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©° ì¤‘ë³µìˆœì—´ ê°œìˆ˜ë¥¼ ê³„ì‚°í•´ì•¼ í•˜ëŠ”ë°,

ëª¨ë“ˆëŸ¬ ì—°ì‚° ê³µì‹ì— **ë‚˜ëˆ—ì…ˆì€ ì •ì˜ë˜ì–´ìˆì§€ ì•Šìœ¼ë¯€ë¡œ** ëª¨ë“ˆëŸ¬ ì—­ì›ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

<br />

#### ğŸ“Œ ëª¨ë“ˆëŸ¬ ì—­ì› êµ¬í•˜ê¸°

ëª¨ë“ˆëŸ¬ ì—­ì›ì€ í˜ë¥´ë§ˆì˜ ì†Œì •ë¦¬ or í™•ì¥ ìœ í´ë¦¬ë“œ í˜¸ì œë²• ì¤‘ ì„ íƒí•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆê³ 

ë§Œì•½ ì‚¬ì „ ê³„ì‚°í•˜ì—¬ ë°°ì—´ë¡œ ë‹¤ êµ¬í•´ë‘˜ ëª©ì ì´ë©´ ì´ $O(n\,log\,n)$ ë³µì¡ë„ë¥¼ ê°€ì§„ í˜ë¥´ë§ˆ ì†Œì •ë¦¬ë³´ë‹¨

ì¬ê·€ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” í™•ì¥ ìœ í´ë¦¬ë“œ í˜¸ì œë²•ì´ ì¢€ ë” ë‚˜ì„ ìˆ˜ ìˆê² ë‹¤.

í•˜ì§€ë§Œ ì“°ì´ëŠ” ì—­ì›ì´ í•œì •ë˜ì–´ìˆê¸° ë•Œë¬¸ì— í¼í¬ë¨¼ìŠ¤ë¥¼ ìœ„í•´ì„  í˜ë¥´ë§ˆë¡œ ê°€ëŠ”ê²Œ ë‚˜ì•„ë³´ì¸ë‹¤. ã…¡_ã…¡

<br />

#### ğŸ“Œ ë°±íŠ¸ë˜í‚¹ìœ¼ë¡œëŠ” ë¶€ì¡±í•˜ë‹¤

í’€ì´ ì½”ë“œì˜ dp í•¨ìˆ˜ê°€ ì›ë˜ëŠ” dfsì˜€ê³  `prev` ì¸ìë¥¼ ê°€ì§€ê³  ìˆì—ˆë‹¤.

`prev`ëŠ” ì´ì „ì— ì„ íƒí•œ ìˆ«ìê°’ì´ê³ , ì´ì „ ì„ íƒ ê°’ ë¯¸ë§Œìœ¼ë¡œëŠ” ì„ íƒí•˜ì§€ ì•Šê²Œë” ë¡œì§ì„ ì‘ì„±í–ˆì—ˆë‹¤.

í•˜ì§€ë§Œ numì˜ ê¸¸ì´ê°€ ê¸¸ì–´ì§€ë©´ ë‹¤ìŒì˜ TCì—ì„œ TLEê°€ í„°ì§„ë‹¤.

<details>
<summary>ë°±íŠ¸ë˜í‚¹ ì½”ë“œ</summary>

```java
class Solution {
    final int MOD = 1_000_000_007;
    int[] cnt = new int[10];
    int[] selectedCnt = new int[10];
    long[] fact = new long[41]; // index: 0 ~ 80/2
    long[] inv = new long[41];
    long[] invFact = new long[41];
    int n = 0;
    int sum = 0; // should always be even

    public int calc(int len) {
        long res1 = fact[len];
        for (int i = 0; i < 10; ++i) {
            if (selectedCnt[i] == 0) continue;
            res1 = res1 * invFact[selectedCnt[i]] % MOD;
        }

        long res2 = fact[n-len];
        for (int i = 0; i < 10; ++i) {
            if (cnt[i] == 0) continue;
            res2 = res2 * invFact[cnt[i]] % MOD;
        }
        
        return (int) (res1 * res2 % MOD);
    }

    public int dfs(int prev, int curSum, int depth) { // prev: last selected digit
        if (curSum > sum/2) return 0;
        if (depth == n/2+1) {
            return curSum == sum/2 ? calc(depth-1) : 0;
        }

        int res = 0;
        for (int i = prev; i < 10; ++i) {
            if (cnt[i] == 0) continue; // can't select
            --cnt[i];
            ++selectedCnt[i];
            res = (res + dfs(i, curSum+i, depth+1)) % MOD;
            --selectedCnt[i];
            ++cnt[i];
        }

        return res;
    }

    public int countBalancedPermutations(String num) {
        this.n = num.length();
        for (char ch : num.toCharArray()) {
            ++cnt[ch-'0'];
            sum += (ch-'0');
        }
        
        if ((sum & 1) == 1) return 0; // can't satisfy condition

        precalc();
        return dfs(0, 0, 1);
    }

    public void precalc() {
        fact[0] = inv[0] = invFact[0] = 1;
        for (int i = 1; i < 41; ++i) fact[i] = fact[i-1] * i % MOD;
        inv[1] = 1;
        for (int i = 2; i < 41; ++i) inv[i] = MOD - (MOD/i) * inv[MOD%i] % MOD;
        for (int i = 1; i < 41; ++i) invFact[i] = invFact[i-1] * inv[i] % MOD;
    }
}
```

</details>

```text title=TC
"9103224235015855909098892653211286258658354677013618352"
```

<br />

### ë©”ëª¨

- ì˜ë¯¸ê¶Œ ë¬¸ì œì—ì„œ digitì´ë¼ê³  í•˜ë©´ leading zeroê°€ í—ˆìš©ë˜ê³ , numberë¼ê³  í•˜ë©´ ì•ˆëœë‹¤.
- DP ì •ì˜ê°€ ê¹Œë‹¤ë¡œìš´ í¸ì´ë‹¤.
- ëŒ€íšŒ ë¬¸ì œì´ê³  ì¼ë°˜ì ì¸ ì½”í…Œì— ë‚˜ì˜¬ ë¦¬ ì—†ëŠ” ìœ í˜•.
    - ì´ê±¸ ë°ì¼ë¦¬ ë¬¸ì œë¡œ ë‚´ë†“ëŠ”ê²Œ ë ˆì „ë“œ...ğŸ˜®