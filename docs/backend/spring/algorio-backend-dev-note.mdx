---
title: 'Algorio 백엔드 개발 노트'
eng_title: 'Algorio backend dev note'
image: https://til.qriositylog.com/img/m_banner_background.jpg
created_date: 2022-06-04
updated_date: 2022-06-11
---

## 📅 22-03-24
### 📌 Cannot resolve symbol 에러 해결

- 잘 돌아가다가 어느날 갑자기 모든 import에 빨간줄 그어져서 당황
- Refresh Gradle Dependencies로 해결
    - [아주 좋은 글](https://ottl-seo.tistory.com/entry/IntelliJ-Cannot-resolve-symbol-%EC%97%90%EB%9F%AC-%ED%95%B4%EA%B2%B0)

## 📅 22-03-25
### 📌 **젠킨스 설치 삽질 끝**

- **링크:** [http://qriositylog.com:8081](http://qriositylog.com:8081)
- **기록:** [https://til.qriositylog.com/featured/devops/jenkins/setting-jenkins-server-with-oracle-cloud](https://til.qriositylog.com/featured/devops/jenkins/setting-jenkins-server-with-oracle-cloud)

### 📌 알게된 것

- 포트가 바뀌지 않았던 이유가 포트 충돌이 아니라 conf 수정 후 `jenkins start` 대신 `install jenkins`를 또 해서 버그가 터졌던 것 같음
    - 이 경우 **무조건 재설치** 해야 함. 백날천날 `jenkins restart` 해도 버그 안풀림
- GitHub에 있는 [jenkins App](https://github.com/apps/ci-jenkins-io)은 jenkins 프로젝트 ci 전용임: [https://ci.jenkins.io/](https://ci.jenkins.io/)
    - 내 프로젝트에 같은 방식 쓰고 싶으면 App을 따로 만들어야 함 [[튜토리얼](https://www.jenkins.io/blog/2020/04/16/github-app-authentication/)]
- *jenkins.qriositylog.com* 과 같은 서브도메인을 원한다면 리버스 프록시 설정해야 함
- **‘docker는 왜 쓰는걸까’**에 대한 결론
    - jar 말고 도커 이미지로 배포하면 편함
    - 컨테이너 단위 백업이 편함
    - Ops의 편의성 때문이고 없어도 문제 생기진 않음

### 📌 추가로 생각해본 것

- docker ci를 사용하면 얘가 다 빌드할건데 그때 jenkins는 무엇을 하는가
    - 아마 unit test...?
    - 젠킨스 + docker 사용 사례 더 찾아보고 무난한 조합법으로 결정하기

![architecture_0](https://user-images.githubusercontent.com/77003554/178111719-2345435e-d0df-4285-8f15-7cf3f9aaf543.png)

![architecture_1](https://user-images.githubusercontent.com/77003554/178111657-dd36c4ec-8c54-41dc-b100-fa746a7aa85b.png)

## 📅 22-03-27
### 📌 JPA 적용 및 CRUD 테스트 연습

- **기록:** [https://til.qriositylog.com/featured/backend/spring/스프링-부트와-AWS로-혼자-구현하는-웹-서비스/chapter-03#2-spring-data-jpa-적용하기](https://til.qriositylog.com/featured/backend/spring/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8%EC%99%80-AWS%EB%A1%9C-%ED%98%BC%EC%9E%90-%EA%B5%AC%ED%98%84%ED%95%98%EB%8A%94-%EC%9B%B9-%EC%84%9C%EB%B9%84%EC%8A%A4/chapter-03#2-spring-data-jpa-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0)

## 📅 22-03-30
### 📌 등록/수정/조회 API 작성 연습

- **기록:** [https://til.qriositylog.com/featured/backend/spring/스프링-부트와-AWS로-혼자-구현하는-웹-서비스/chapter-03#4-등록수정조회-api-만들기](https://til.qriositylog.com/featured/backend/spring/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8%EC%99%80-AWS%EB%A1%9C-%ED%98%BC%EC%9E%90-%EA%B5%AC%ED%98%84%ED%95%98%EB%8A%94-%EC%9B%B9-%EC%84%9C%EB%B9%84%EC%8A%A4/chapter-03#4-%EB%93%B1%EB%A1%9D%EC%88%98%EC%A0%95%EC%A1%B0%ED%9A%8C-api-%EB%A7%8C%EB%93%A4%EA%B8%B0)

## 📅 22-04-02
### 📌 등록/수정/조회 API 테스트 코드 작성 및 push

- **기록:** `작성예정`

## 📅 22-04-03
### 📌 젠킨스 GH App 생성 및 연결

- [아주 좋은 글](https://fwani.tistory.com/23)
    - App credential config에서 owner 명시해주어야 500 internal error 풀림
- pem 변환은 WSL로 함: [경로 찾기](https://unix.stackexchange.com/questions/531576/how-do-i-access-my-windows-desktop-directory-from-inside-windows-subsystem-for-l)
- gradle test 돌리기에 인스턴스가 너무 협소해서 하루종일 돌아감...
    - 서버 마비돼서 reboot 하고 `iptables` 다시 설정해줌
- App을 써도 WebHook으로 트리거 시키는건 똑같음. App은 그냥 Credential 용도같음. WebHook으로 할 때 commit status는 어떻게 돌아오는지 나중에 확인해보기
    - [참고 레퍼런스 1](https://applitools.com/blog/how-to-update-jenkins-build-status-in-github-pull-requests-step-by-step-tutorial/)
    - [참고 레퍼런스 2](https://stackoverflow.com/questions/14274293/show-current-state-of-jenkins-build-on-github-repo)
- 젠킨스 UI가 너무 구려서 [Blue Ocean 플러그인](https://logical-code.tistory.com/179)이 필수인듯,,
- **더 좋은 무료 서버 구할 시간 없어서 일단 GH Action으로 테스트 CI 구축함.**

### 📌 GH Action Test, Build & Deploy CI 구축

- Test는 간단히 템플릿에서 꺼내다 씀
    - **테스트 CLI 로그 이쁘게 보여주는 플러그인:** `com.adarshr.test-logger`
- [x]  Build는 아직 Dockerfile 없어서 도커 배포까진 안됨. 나중에 작성하기
- `workflow_run` 트리거가 default branch(main) 에서만 작동된다는 점은 괜찮은데, commit status 안나오는건 좀 치명적이라 WebHook으로 status 보여주는 workflow를 하나 더 추가함.
    - [아주 좋은 글](https://dev.to/doctolib/github-actions-how-to-push-a-github-status-in-addition-of-github-checks-3d27)
- GH Action 커스텀 뱃지 가능한거 오늘 처음 알음. url에 workflow filename이 아니라 workflow name이 들어가는게 특이함.
    - [여기서 배움](https://github.com/docker/build-push-action)
- 처음에 [도커허브에서 build 시켜서 이쁘게 commit status가 App으로 나오는 걸](https://github.com/docker/app) 의도했으나, 최근 도커허브 빌드 기능이 유료화되어서 빠른 손절.
- [x]  branch 전략 시간날때 정리하기
- [x]  배포 전략 고민하기 ([프론트, 백 분리 관련](https://okky.kr/article/874573))

## 📅 22-04-05
### 📌 Docker 배포 CI 에러 해결

- Dockerfile 작성했더니 다음의 에러 발생

```
Step 3/4 : COPY ${JAR_FILE} app.jar
When using COPY with more than one source file, the destination must be a directory and end with a /
```

- 로그 읽어보면 여러개 jar이라 단일 jar에 copy가 안되니 path 형식으로 arg를 넘기라는 건데, 다른 사람들은 똑같은 명령어로도 잘만 돌리니까 의문.
    - 확인 결과 내가 `gradle build` 시키면 `build/libs`경로에 plain이 붙는 jar이 하나 더 생겼음
    - 이유 찾아보니 스프링부트 2.5 부터 plain도 생기도록 바뀌었다고 함. [[참고](https://dev-j.tistory.com/22)]
    - plain 없이 그냥 executable jar만 빌드하려면 `gradle bootJar` 을 사용해야 함
        - [build와 bootJar의 차이?](https://stackoverflow.com/questions/64747475/difference-between-gradle-build-and-gradle-bootjar)
    - Dockerfile은 그대로 둔 채로 yml에 gradle 명령어만 바꿔주고 에러 해결

### 📌 Package Publish CI 구축

- 도커 이미지를 위한 GH 레지스트리도 있더라.. Dockerfile `LABEL`에 내 repo 넣고 GH 레지스트리에 push하면 package에 뜬대서 release 때마다 트리거되는 CI 구축
    - [아주 친절한 글](https://blog.codecentric.de/en/2021/03/github-container-registry/)
    - [덜 친절하지만 한글](https://blog.outsider.ne.kr/1530)
    - [GH 레퍼런스](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#release)

![reference](https://user-images.githubusercontent.com/77003554/178112382-afacdb34-6a1b-4dde-9cf0-d040a4a33535.png)

- GH에서 release 할때 태그 추가하면 ref가 `refs/heads/main`이 아닌 ~~ 이다. [[정답은 여기에](https://stackoverflow.com/questions/58475748/github-actions-how-to-check-if-current-push-has-new-tag-is-new-release)]

### 📌 `1.0.0-beta.1` 릴리즈 👏

- GH에서 prerelease 말고 그냥 release로 작성해야 제목이 뜸

### 📌 Branch 전략

- **main:** 푸시되면 도커로 자동 배포됨. 나중에 EC2 SSH까지 연결할거니 주의..
    - docs 수정은 대체 어디서 할지 모르겠음.
- **develop:** 각 릴리즈 별로 feature merge 한 뒤 버전 수정같은거 해놓는 브랜치
    - CI 수정은 가급적 develop에서 하기
- **feature:** 필요할때마다 develop에서 분기하고 merge되면 자유롭게 삭제 가능한 브랜치
- release 브랜치는 개인 프로젝트 운영하는데 너무 과하다 싶어서 안 씀.

### 📌 Frontend, Backend repo 분리

- 합치면 다루기도 불편하고 폴더 구조도 마음에 안들 것 같아서 결국 분리하기로 결정
- 여태까지 작업한 repo는 `Algorio`에서 `Algorio-Backend`로 리포명 수정
- Frontend는 AWS말고 Vercel 같은거 쓰면 좋을듯. commit status도 이쁘게 써줌.
