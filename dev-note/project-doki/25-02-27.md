---
title: '25-02-27'
eng_title: '25-02-27'
image: https://til.qriositylog.com/img/m_banner_background.jpg
sidebar_position: 7
sidebar_label: '25-02-27'
created_date: 2025-02-27
updated_date: 2025-02-27
---

### ğŸ“Œ Daily Report
> [https://github.com/ssginc-be/DOKI/issues/23](https://github.com/ssginc-be/DOKI/issues/23)

<br/>

### ğŸ“Œ í”„ë¡œì íŠ¸ ìƒí™©

ëª¨ë“ ê²Œ ì˜ë˜ê³  ìˆì—‰!

*~~êµ¬ë¼ì„~~*

<br />

### ğŸ“Œ cmd: "ëª…ë ¹ì¤„ì´ ê¸¸ì–´ìš”"

![cmdì°½](https://github.com/user-attachments/assets/0da908fe-8467-4b9b-8969-ed8f2a319b6b)

[Kafka íŒŒì¼ ê²½ë¡œë¥¼ `C:`ì— ë‘ì–´ì•¼ í•œë‹¤.](https://velog.io/@sodliersung/kafka-window-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EC%8B%A4%ED%96%89-%EC%97%90%EB%9F%AC) ê·¸ì € ë†€ë¼ìš´.......;

<br />

### ğŸ“Œ ì•„í‚¤í…ì³, ì´ìƒê³¼ í˜„ì‹¤

![ê°€ë‚œí•œ_ì•„í‚¤í…ì³](https://github.com/user-attachments/assets/56597521-0d08-4a77-8de3-10aa66d0fe0c)

ê·¸ë¦¬í•˜ì—¬, ì¹´í”„ì¹´ëŠ” GCPì— ì˜¬ë¦¬ê³  ê°œë°œí•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤.

í”„ë ˆì  í…Œì´ì…˜ ë•Œ 100% ì§ˆë¬¸ ë“¤ì–´ì˜¬ ê²ƒ ê°™ì•„ì„œ ë°©ì–´ì „(?)ì„ ìœ„í•´ ê·¸ë ¤ë†¨ë‹¤.

<br />

### ğŸ“Œ Kafka, Zookeeper ì»¨í…Œì´ë„ˆ ì„¤ì¹˜
```yaml title=compose.yml
services:
  zookeeper:
    image: wurstmeister/zookeeper
    container_name: zookeeper
    ports:
      - "2181:2181"
  kafka:
    image: wurstmeister/kafka:2.13-2.8.1
    container_name: kafka
    ports:
      - "9092:9092"
    environment:
      KAFKA_ADVERTISED_HOST_NAME: 127.0.0.1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
```
...ë§ì´ ì“°ì´ëŠ” ê²ƒê³¼ ë³„ê°œë¡œ, ë§ˆì§€ë§‰ìœ¼ë¡œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡ëœ ì»¨í…Œì´ë„ˆê°€ ìƒë‹¹íˆ êµ¬ë²„ì „ì´ì—ˆë‹¤. ì§€ê¸ˆ latest ì¹´í”„ì¹´ ë²„ì „ì´ `2.13-3.9.0`ì¸ë° ã…œ

ê·¸ë˜ë„ ë°”ì˜ë‹ˆê¹Œ ì¼ë‹¨ ì“°ì.

<br />

### ğŸ“Œ Docker ì†Œì¼“ ê¶Œí•œ ì„¤ì •í•˜ê¸°
```bash
$ docker compose -f compose.kafka.yml up -d
unable to get image 'wurstmeister/kafka:2.13-2.8.1': permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.47/images/wurstmeister/kafka:2.13-2.8.1/json": dial unix /var/run/docker.sock: connect: permission denied
```

ì¹´í”„ì¹´ ì„¤ì¹˜í•˜ë‹¤ê°€ í„°ì§„ ë¬¸ì œì¸ë°, `/var/run/docker.sock` íŒŒì¼ì˜ ê¶Œí•œì„ 666ìœ¼ë¡œ ë³€ê²½í•˜ë©´ ëœë‹¤ê³  í•œë‹¤.

```bash
$ sudo chmod 666 /var/run/docker.sock
```

<br />

### ğŸ“Œ compose downì‹œ ë³¼ë¥¨ ì œê±°í•˜ê¸°
```bash
$ docker compose -f compose.kafka.yml down -v
```

ë‚˜ëŠ” ì™œ ê·¸ë™ì•ˆ `docker rm -v $(docker ps -qa)`ë¡œ ì‚½ì§ˆì„ í•˜ì˜€ëŠ”ê°€

*ê·¸ë˜ë„ ëª…ë ¹ì–´ ì™¸ìš°ëŠ”ë° ë„ì›€ë¨*<br />
~~*ì•„ë‹ˆ ê·¸ê±¸ ì™œ ì™¸ì›Œìš”?*~~

<br />

### ğŸ“Œ Kafka í† í”½ ê´€ë ¨ ëª…ë ¹ì–´

#### Kafka ì»¨í…Œì´ë„ˆ ì‰˜ ì ‘ì†
```bash
$ docker container exec -it kafka bash
```

#### Kafka í† í”½ ë¦¬ìŠ¤íŠ¸ í™•ì¸
```bash
$ kafka-topics.sh --list --bootstrap-server localhost:9092
```

#### Kafka í† í”½ ìƒì„±
```bash
$ kafka-topics.sh --create --bootstrap-server localhost:9092 --topic doki-reserve
```

#### Kafka í† í”½ ì‚­ì œ
```bash
$ kafka-topics.sh --delete --bootstrap-server localhost:9092 --topic doki-reserve
```

<br />

### ğŸ“Œ reserve-serviceì™€ Kafka ì—°ê²°

ì œì¼ ë¨¼ì € GCP ë°©í™”ë²½ì—ì„œ TCP 9092 ì¸ë°”ìš´ë“œë¥¼ í—ˆìš©í•´ì£¼ì—ˆë‹¤.

ê·¸ë¦¬ê³  [ìš” ë ˆí¼](https://dkswnkk.tistory.com/705)ë¥¼ ì°¸ê³ í•´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆëŠ”ë°..

```
20:59:02.335[org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-doki-1, groupId=doki] Connection to node 1001 (/127.0.0.1:9092) could not be established. Node may not be available.
```

ë­ í˜¸ìŠ¤íŠ¸ ì„¤ì •ì´ ì˜ëª»ëœ ê²ƒ ê°™ì€ë°,

ìƒê°í•´ë³´ë‹ˆê¹Œ compose ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `KAFKA_ADVERTISED_HOST_NAME: 127.0.0.1`ì´ ìƒê°ë‚¨.

ì•„ ì„¤ë§ˆ ì´ê±° GCP ì¸ìŠ¤í„´ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì„¸íŒ…í•´ì•¼ë˜ëŠ”ê±´ê°€? í•˜ê³  ë‹¤ì‹œ ì„¤ì •í•´ì„œ compose up í•´ì¤¬ë”ë‹ˆ

```
21:09:06.733[kafka-producer-network-thread | reserve-service-producer-1] WARN  o.apache.kafka.clients.NetworkClient - [Producer clientId=reserve-service-producer-1] Error while fetching metadata with correlation id 1 : {doki-reserve=LEADER_NOT_AVAILABLE}
```

?

SSH ì ‘ì†í•´ì„œ ì¹´í”„ì¹´ ì»¨í…Œì´ë„ˆë¥¼ í™•ì¸í•´ë³´ë‹ˆ `doki-reserve` í† í”½ì€ ìƒì„±ë˜ì–´ìˆì—ˆë‹¤. ê·¸ëŸ¼ ì—°ê²°ì€ ëœê±´ë°? ë­ì§€?