---
title: '25-03-09'
eng_title: '25-03-09'
image: https://til.qriositylog.com/img/m_banner_background.jpg
sidebar_position: 13
sidebar_label: '25-03-09'
created_date: 2025-03-09
---

### ğŸ“Œ Daily Report
> [https://github.com/ssginc-be/DOKI/issues/52](https://github.com/ssginc-be/DOKI/issues/52)

<br/>

### ğŸ“Œ í”„ë¡œì íŠ¸ ìƒí™©

ì—¬ì „íˆ êµ¬í˜„í•  ê²ƒì´ ì‚°ë”ë¯¸ì´ê³ , ì½”ë“œ ë¦¬ë·°ê°€ ë“¤ì–´ì™€ì„œ ê²€í†  í›„ ë¦¬íŒ©í† ë§í•´ì•¼ í•˜ê³ , Kibana ì¸ì½”ë”© ë¬¸ì œë„ í•´ê²° ëª»í–ˆë‹¤.

![task_ëª©ë¡](https://github.com/user-attachments/assets/ffe35690-d7f6-41fd-8a1a-b05d12b77fc2)

ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹

ë†€ëê²Œë„ ì˜¤ëŠ˜ í•˜ê³ ì‹¶ì€ ë§Œí¼ ì ì–´ë†“ì€ ê²ƒì´ê³ , ì‹¤ì œë¡œëŠ” í•  ì¼ ë” ë§ìŒ.

API Gatewayì™€ https ì„¤ì •ì„ ë§‰íŒì— ë§ˆë¬´ë¦¬í•˜ë©´ì„œ í•˜ë ¤ í–ˆëŠ”ë°... ëª©ìš”ì¼ë¶€í„° ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ ì‘ì„±í•˜ë ¤ë©´ ì½”ë“œ ë¦¬ë·° ê²€í† ê¹Œì§€ë§Œ í•˜ê³  ë¦¬íŒ©í† ë§ì„ í›„ìˆœìœ„ë¡œ ë°€ì–´ì•¼ í•  ë“¯ ì‹¶ë‹¤.ğŸ™„

<br />

### ğŸ“Œ JS ë¹„ë™ê¸° ì²˜ë¦¬ ìŠ¤ì½”í”„

ê·¸ë™ì•ˆ ì™œ `async`-`await` ë¶™ì—¬ë„ ë ë•Œê°€ ìˆê³  ì•ˆë ë•Œê°€ ìˆëŠ”ì§€ ì˜ë¬¸ì¸ ì ì´ ëª‡ ë²ˆ ìˆì—ˆëŠ”ë°,

[ì´ ë ˆí¼ëŸ°ìŠ¤](https://growing-jiwoo.tistory.com/74)ì—ì„œ ì¤‘ìš”í•œ ëª…ì–¸ì„ í•˜ë‚˜ ë‚¨ê²¨ë†“ì€ ê²ƒ ê°™ë‹¤.

> "ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ async/await ì‚¬ìš© ì‹œ ë™ì¼í•œ ìŠ¤ì½”í”„ì—ì„œ awaití•˜ì§€ ì•Šìœ¼ë©´ ì•ì„œ ì‹¤í–‰í•œ asyncë¥¼ ê¸°ë‹¤ë ¤ì£¼ì§€ ì•ŠëŠ”ë‹¤."

ê·¸ëŸ¬í•˜ë‹¤. ìŠ¤ì½”í”„...

ì™œ ì•„ë¬´ë„ ìŠ¤ì½”í”„ì— ëŒ€í•´ì„œ ì–˜ê¸°ë¥¼ ì•ˆí–ˆë˜ê±°ì§€? ì´ ì„¸ ê¸€ìë¡œ ì´í•´ê°€ ë°”ë¡œ ë˜ëŠ”ë°.

<br />

### ğŸ“Œ ERD 4ì°¨ ìˆ˜ì •ì— ë”°ë¥¸ ì‚¬ì´ë“œ ì´í™íŠ¸

ì‚¬ê±´ì˜ ë°œë‹¨ì€ ì´ëŸ¬í–ˆë‹¤.

1. íŒì—…ìŠ¤í† ì–´ ìƒì„¸ í˜ì´ì§€ì— ìš´ì˜ ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì´ ë“¤ì–´ê°ˆ í•„ìš”ê°€ ìˆìŒì„ ëŠë‚Œ
2. ì–´ ê·¼ë° íŒì—…ìŠ¤í† ì–´ í…Œì´ë¸”ì— ê´€ë ¨ ì¹¼ëŸ¼ì´ ì—†ë„¤? ì¶”ê°€í•´ì•¼ì§€
3. ì´ë¯¸ ìš´ì˜ ì‹œì‘ì¼ì„ `storeStart`, ì¢…ë£Œì¼ì„ `storeEnd` ë„¤ì´ë°ìœ¼ë¡œ ë‘ê³  ìˆìŒ
4. ìš´ì˜ ì‹œê°„ì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ ìš´ì˜ ì¼ì ì¹¼ëŸ¼ëª…ì— `Date`ë¥¼ ë¶™ì´ê³ , ìš´ì˜ ì‹œê°„ì€ ë’¤ì— `Time`ì„ ë¶™ì´ê¸°ë¡œ í•¨
5. `Store` ì—”í‹°í‹° ìˆ˜ì •

![it_was_a_complete_disaster](https://github.com/user-attachments/assets/64ab3429-0265-433f-a1d6-0296311754ee)

<sup><b>ê·¸ë¦¬ê³  ì‚¬ì´ë“œ ì´í™íŠ¸ë¥¼ í¬ê²Œ ë§ì•˜ë‹¤. ^0^</b></sup>

`data.sql` íŒŒì¼ ì–˜ê°€ ì œì¼ í° ë¬¸ì œì¸ë°, ì´ë ‡ê²Œ ì¹¼ëŸ¼ ë³€ê²½ ë“±ìœ¼ë¡œ í…Œì´ë¸” ìŠ¤í™ì´ ë°”ë€Œì–´ì„œ íŒŒì¼ ë‚´ì˜ INSERTê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì•„ë„, ì•„ë¬´ëŸ° ë¡œê·¸ë¥¼ ë‚¨ê¸°ì§€ ì•ŠëŠ”ë‹¤.

ê·¸ë˜ì„œ ëšœê¹Œ ë§ìœ¼ë©´ì„œ ì•Œê²Œ ë˜ëŠ” ë¶€ë¶„ì¸ë° ì´ë¯¸ ì „ì— ë§ì•„ë´ì„œ, ë‹¤í–‰íˆ ê¸ˆë°© ëˆˆì¹˜ì±„ê¸´ í–ˆë‹¤.

mock data ì¿¼ë¦¬ê°€ ì•ˆë‚ ë¼ê°€ë‹ˆê¹Œ ES ì¸ë±ì‹±ì´ ì•ˆëŒì•„ê°€ê³  -> ì¸ë±ì‹±ì´ ì•ˆë˜ë‹ˆê¹Œ ë©”ì¸í™”ë©´ì—ì„œ ëª©ë¡ ì¡°íšŒê°€ ì•ˆë˜ë”ë¼.

INSERT ì¿¼ë¦¬ë¥¼ ë°”ë€ í…Œì´ë¸” ìŠ¤í™ì— ë§ì¶° ìˆ˜ì •í•˜ë‹ˆ ë‹¤ì‹œ ì¸ë±ì‹±ì€ ëŒì•„ê°€ëŠ”ë°, ë‹¹ì—°íˆ ES Document ìŠ¤í™ë„ ê°™ì´ ìˆ˜ì •í–ˆì–´ì•¼ í–ˆë‹¤. ì´ë²ˆì— ì¶”ê°€ëœ ì¹¼ëŸ¼ì´ ì¸ë±ì‹± ëŒ€ìƒì€ ì•„ë‹ˆì—ˆì§€ë§Œ, ì¸ë±ì‹±í•˜ëŠ” ìš´ì˜ ì¼ì ì¹¼ëŸ¼ëª…ì´ ë°”ë€Œì—ˆê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ë ‡ê²Œ ìˆ˜ì •í•´ì„œ ì„œë²„ë¥¼ ì‹¤í–‰í–ˆëŠ”ë°, íƒ€ì„ë¦¬í”„ê°€ í„°ì§€ë”ë¼. ìµœì´ˆ ë Œë”ë§ë§Œ í…œí”Œë¦¿ ì—”ì§„ìœ¼ë¡œ í•˜ê³  ì´í›„ì˜ ë Œë”ë§ ë³€í™”ëŠ” axios ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ë ¤ í–ˆëŠ”ë° ì´ ë°©ì‹ì´... ë³„ë¡œì¸ê°€?

ì•„ë¬´íŠ¼ ì¹¼ëŸ¼ëª… ë³€ê²½ìœ¼ë¡œ flatpickr ì„¤ì •ê¹Œì§€ í„°ì ¸ì„œ viewë‹¨ê¹Œì§€ ì‹¹ ê³ ì³ì¤˜ì•¼ í–ˆìŒã…œ


<br />

### ğŸ“Œ `@DynamicInsert`ë¥¼ ë“œë””ì–´ ì´í•´í•¨

```java title=ReservationEntry.java
@Entity
@EntityListeners(AuditingEntityListener.class)
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ReservationEntry {
    // ...

    @Column(nullable = false)
    @ColumnDefault("0")
    private Integer reservedCount; // ì˜ˆì•½ì ìˆ˜

    // ...
}
```

```java title=StoreService.java
public class StoreService {
    // ... 

    // 5. ReservationEntry ìƒì„±
    List<ReservationEntry> reList = new ArrayList<>();
    LocalDate endDate = dto.getStoreEndDate();
    LocalTime endTime = dto.getStoreEndTime();

    int reserveGap = dto.getReserveGap();
    int capacity = dto.getCapacity();
    for (LocalDate curDate = dto.getStoreStartDate(); !curDate.isAfter(endDate); curDate = curDate.plusDays(1)) {
        for (LocalTime curTime = dto.getStoreStartTime(); curTime.isBefore(endTime); curTime = curTime.plusMinutes(reserveGap)) {
            reList.add(ReservationEntry.builder()
                    .store(store)
                    .entryDate(curDate)
                    .entryTime(curTime)
                    .capacity(capacity)
                    .entryStatus(ReservationEntry.EntryStatus.OPEN)
                    .build()
            );
        }
    }
    reRepo.saveAll(reList);

    // ...
}
```

```log
20:14:26.751[http-nio-9093-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Failed to complete request: org.springframework.dao.DataIntegrityViolationException: not-null property references a null or transient value: com.ssginc.commonservice.reserve.model.ReservationEntry.reservedCount
```

ì™œ `@ColumnDefault("0")`ê°€ ì•ˆë¨¹íˆê³  ì—ëŸ¬ê°€ ëœ¨ëŠ”ì§€ ì˜ë¬¸ì´ì—ˆëŠ”ë°, [ì´ ê¸€](https://eocoding.tistory.com/71)ì„ ì°¸ê³ í•´ë³´ë©´ `@DynamicInsert`ë¥¼ ì—”í‹°í‹°ì— ëª…ì‹œí•˜ì§€ ì•Šì•˜ê¸°ì—

INSERT ì¿¼ë¦¬ì—ì„œ `reserveCount`ë¥¼ nullë¡œ ë„£ìœ¼ë ¤ í•œ ê²ƒ ê°™ë‹¤.

í•˜ì§€ë§Œ í”„ë¡œì íŠ¸ì˜ ê²½ìš° MySQLì—ì„œ ë””í´íŠ¸ ê°’ 0ì„ ì§€ì •í–ˆê¸° ë•Œë¬¸ì— `@DynamicInsert`ë¥¼ ì¶”ê°€í•´ì„œ ì•„ì˜ˆ INSERT ì¿¼ë¦¬ì—ì„œ `reserveCount` ì¹¼ëŸ¼ì´ ì œì™¸ë˜ì–´ì•¼ í•˜ëŠ” ê²ƒì´ ë§ë‹¤.

...ê·¸ëŸ°ë° `@DynamicInsert` ë„£ì–´ë„ ë˜‘ê°™ì´ ì˜¤ë¥˜ ë°œìƒí•´ì„œ ì¼ë‹¨ ë•œë¹µ ì²˜ë¦¬í•´ë†“ê³  ë‚˜ì¤‘ì— ë‹¤ì‹œ ë””ë²„ê¹…í•´ë´ì•¼ í•  ê²ƒ ê°™ë‹¤.

<br />

### ğŸ“Œ íŒì—…ìŠ¤í† ì–´ ë“±ë¡ API êµ¬í˜„ ì™„ë£Œ

`Store` `StoreImage` `StoreCategory` `ReservationEntry`

ì–˜ë„¤ ì²˜ë¦¬ ìˆœì„œê°€ ì²˜ìŒì— ëª¨í˜¸í–ˆë‹¤.

ì–‘ë°©í–¥ ë§¤í•‘ê´€ê³„ë•Œë¬¸ì— Storeë¥¼ ì €ì¥í•˜ë ¤ë©´ StoreImageì™€ StoreCategoryë„ ê°€ì§€ê³  ìˆì–´ì•¼ í•˜ëŠ”ë°

StoreImageì™€ StoreCategory ì—­ì‹œ Storeë¥¼ ê°€ì§€ê³  ìˆê³ ...

ëˆ„êµ¬ë¥¼ ë¨¼ì €, ì–´ë–»ê²Œ ìƒì„±í•´ì•¼ í•˜ëŠ”ê°€? ë¼ëŠ” ì˜ë¬¸ì´ ë“¤ì—ˆë‹¤.

ê·¸ëŸ°ë° ì½”ë“œ ì‘ì„±í•˜ë‹¤ë³´ë‹ˆ, Elasticsearchì—ì„œ Storeë¥¼ ì¸ë±ì‹±í•´ì•¼í•˜ê³ 

ì¸ë±ì‹±í• ë•Œ StoreImageë„ ìˆœíšŒí•´ì„œ MAIN_THUMBNAILì„ ê°€ì ¸ê°€ê³ 

StoreCategoryë„ CategoryNoDescDtoë¡œ ì¬ê°€ê³µí•´ì„œ ê°€ì ¸ê°€ë‹ˆê¹Œ,

ì¸ë±ì‹±í•˜ê¸° ì „ì—ëŠ” ì–˜ë„¤ê°€ ë©”ëª¨ë¦¬ ìƒì— í• ë‹¹ì´ ë˜ì–´ìˆì–´ì•¼ í•˜ëŠ” ê²ƒì„.

ì •ë¦¬í•˜ìë©´ ì´ë ‡ë‹¤.

---
1. StoreImage, StoreCategoryë§Œ í• ë‹¹ ì•ˆëœ Store ìƒì„± -> ë©”ëª¨ë¦¬ ìƒì— ì¡´ì¬
2. EntityManagerë¡œ Storeë¥¼ persist -> INSERT ì¿¼ë¦¬ ë‚ ë¼ê° (ì´ ì‹œì ë¶€í„° auto incrementëœ id ê°’ ì ‘ê·¼ ê°€ëŠ¥)
3. Storeì˜ id ê°’ìœ¼ë¡œ StoreImageì™€ StoreCategory ìƒì„± -> ë©”ëª¨ë¦¬ ìƒì— ì¡´ì¬
4. Storeì— StoreImage, StoreCategory setí•˜ê¸° -> ë©”ëª¨ë¦¬ ìƒì˜ ê°ì²´ì— í• ë‹¹
5. StoreImage ì €ì¥ (ë‹¹ì—°íˆ StoreCategoryëŠ” ì €ì¥ ì•ˆí•¨.) -> INSERT ì¿¼ë¦¬ ë‚ ë¼ê°
6. ReservationEntry ìƒì„± ë° ì €ì¥ -> INSERT ì¿¼ë¦¬ ë‚ ë¼ê°
7. Elasticsearch ì¸ë±ì‹± -> ë©”ëª¨ë¦¬ ìƒì˜ Store ê°ì²´ë¡œ ì²˜ë¦¬í•¨
8. `@Transactional`ì— ì˜í•´ COMMIT
---

ê²°êµ­ì—”, ë©”ëª¨ë¦¬ ìƒì˜ ê°ì²´ê¹Œì§€ë§Œ í•„ìš”í•œ ë¶€ë¶„ì´ ì–´ëŠ ì§€ì ì¸ì§€,

ê·¸ë¦¬ê³  DBì— ì¿¼ë¦¬ê°€ ë‚ ë¼ê°€ì•¼ í•˜ëŠ” ì§€ì ì´ ì–´ëŠ ì§€ì ì¸ì§€ë¥¼ ëª…í™•íˆ ì•Œê³  ìˆì–´ì•¼ í–ˆë‹¤.

StoreëŠ” ëŒ€ë¶€ë¶„ì´ `@OneToMany`ë¡œ ìì‹ì´ ë§¤í•‘ëœ ë¶€ëª¨ ì—”í‹°í‹°ì´ê³ , ìì‹ ì •ë³´ê°€ DBì— INSERT ë‚ ë¦´ ë•ŒëŠ” ë”±íˆ í•„ìš” ì—†ìœ¼ë‹ˆê¹Œ, Storeë¥¼ persistí•´ì„œ INSERT ì¿¼ë¦¬ë¥¼ ë¨¼ì € ë‚ ë¦¬ëŠ” ê²ƒì´ ì˜³ì€ ìˆœì„œì˜€ë˜ ê²ƒì´ë‹¤.

JPAì—ì„œ ë¶€ëª¨-ìì‹ ì—”í‹°í‹° í•œë²ˆì— ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤ê³ ëŠ” í•˜ëŠ”ë° ì´ëŠ” ë‚˜ì¤‘ì— ë¦¬íŒ©í† ë§í•´ë³´ê¸°ë¡œ í•˜ê³ 

ë¬´ì‹í•˜ê²Œ ìƒê°í•˜ìë©´ ìƒë‹¨ì˜ ì € ìˆœì„œê°€ ì§ê´€ì ì´ë‹¤.


#### âœ¨ êµ¬í˜„ ê²°ê³¼

ê³ ìƒí–ˆë‹¤. ê·¼ë° resizing ì˜µì…˜ì„ ì˜ëª» ì„¤ì •í•œë“¯ ã…‹ã…‹ã…‹ã…‹

ë²„ê·¸ ë¦¬í¬íŠ¸... ì¶”ê°€ìš”...

![store_image_table](https://github.com/user-attachments/assets/be9b90db-ecb5-4c4e-bb6d-8e504150b578)

![store_reservation_page](https://github.com/user-attachments/assets/6dc5e471-7c0c-4d26-857d-d21b58be90d3)