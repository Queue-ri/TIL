---
title: '25-03-19'
eng_title: '25-03-19'
image: https://til.qriositylog.com/img/m_banner_background.jpg
sidebar_position: 23
sidebar_label: '25-03-19'
created_date: 2025-03-19
updated_date: 2025-03-20
---

### ğŸ“Œ Daily Report
> [https://github.com/ssginc-be/DOKI/issues/126](https://github.com/ssginc-be/DOKI/issues/126)

<br/>

### ğŸ“Œ í”„ë¡œì íŠ¸ ìƒí™©

ì•ˆíƒ€ê¹ê²Œë„ ë‚´ ì²´ë ¥ì´ ì˜ì§€ì— ì•ˆ ë”°ë¼ì£¼ëŠ” ê²ƒ ê°™ë‹¤.

ëª¨ë‹ˆí„°ë¥¼ ëª» ì³ë‹¤ë³´ê² ì„ ì •ë„ë¡œ í¸ë‘í†µì— ì•ˆêµ¬ê±´ì¡°ì¦ì— ë¬µì§í•œ í”¼ë¡œì— ë­”ì§€ ëª¨ë¥¼ ë¶• ëœ¬ ëŠë‚Œê¹Œì§€ ë“¤ì–´ì„œ ê±°ì˜ ëˆˆ ê°ì€ì±„ë¡œ ë³‘ì›ì— ê°”ë‹¤.

í…ìŠ¤íŠ¸ë§Œ ë³´ë©´ ë­”ê°€ ìƒìƒ‰ë‚´ëŠ”ê±° ê°™ì€ë° ì €ê²Œ ë‹¤ ì¢…í•©ì„¸íŠ¸ë¡œ ì˜¤ë‹ˆê¹Œ ì–µì§€ë¡œ ëª¨ë‹ˆí„° ë³´ë©´ì„œ ì‘ì—…í•´ë„ í•œ 70%ëŠ” ë©ë•Œë¦´ ê²ƒ ê°™ì„ ì •ë„ë¡œ í˜ë“¤ì—ˆë‹¤.

ê·¸ë˜ì„œ ìˆ˜ì•¡ 2ì¢…ë¥˜ ì„ì–´ ë§ê³  ì§„í†µì œë„ ì²˜ë°©ë°›ì•˜ëŠ”ë°, ì¢€ ë¹„ì‹¼ê²Œ í ì´ì§€ë§Œ ê¸°ì ê°™ì´ ì§€ì˜¥ì—ì„œ ì‚´ì•„ë‚˜ì™”ë‹¤; ì†”ì§íˆ ê¸°ëŒ€ ì•ˆí–ˆëŠ”ë° ë¬´ìŠ¨ ë¯¸ë˜ ìˆ˜ëª… ë•¡ê²¨ì˜¨ì¤„ ã…‹ã…‹ã…‹

ìƒíƒœê°€ í˜¸ì „ë¼ì„œ ë‹¤í–‰ì´ì§€ë§Œ ë‚´ì‹¬ ì§œì¦ì´ ë‚œë‹¤.

ì•„ë‹ˆ ì™œ ì²´ë ¥ì´ í˜‘ì¡°ë¥¼ ì•ˆí•´ì£¼ì§€?

ë‚´ê°€ ì–¼ë§ˆë‚˜ ì•„ì¹¨ì—ë„ ë‚®ì—ë„ ì €ë…ì—ë„ ìƒˆë²½ì—ë„ ê°œë°œí•˜ê³  ì‹¶ì€ë°? ì§€ê¸ˆ í• ê²Œ ì–¼ë§ˆë‚˜ ë§ì€ë°?

<br />

### ğŸ“Œ ë¬´ì˜ë¯¸í•œ `synchronized`

ì˜ˆì•½ ë™ì‹œì„± TDDê°€ ë“œë””ì–´ ë§ˆë¬´ë¦¬ ë˜ì—ˆë‹¤. í…ŒìŠ¤íŠ¸ëŠ” 10000ëª…ì˜ ì •ì›ì„ ê°€ì§„ ì—”íŠ¸ë¦¬ì— ëŒ€í•˜ì—¬ 50000ê°œì˜ ë™ì‹œ ì˜ˆì•½ ì‹œë„ë¥¼ ê±¸ì—ˆëŠ”ë°, ê°’ì´ í¬ë‹¤ë³´ë‹ˆ í™˜ê²½ ì„¸íŒ…ë„ ë“¤ì–´ê°€ì„œ ìƒê°ë³´ë‹¤ ê¹Œë‹¤ë¡­ë”ë¼. ì¼ë‹¨ ë‹¤ìŒì˜ ì„¤ì •ë“¤ì´ í•„ìš”í–ˆë‹¤.

---
1. MySQLì˜ max-connections ëŠ˜ë¦¬ê¸° (-> í´ë¼ì´ì–¸íŠ¸ ì ‘ì†í•´ì„œ ì„¤ì •)
2. JVM heap memory ëŠ˜ë¦¬ê¸° (-> gradle íŒŒì¼ì—ì„œ ì„¤ì • [[ë ˆí¼ëŸ°ìŠ¤]](https://stackoverflow.com/questions/52733942/increase-heap-memory-for-gradle-test/52745454))
3. hikari max-pool ë° timeout ëŠ˜ë¦¬ê¸° (-> ymlì—ì„œ ì„¤ì •)
---

í•˜ë‹¨ì€ ë³„ë‹¤ë¥¸ ì²˜ë¦¬ ì—†ì´ ì„œë¹„ìŠ¤ì— @Transactionalë§Œ ë¶™ì¸ í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ì´ë‹¤.

![test_result_none](https://github.com/user-attachments/assets/fdee0152-bb61-4089-874b-205734210f84)

<br />

ê·¸ë¦¬ê³  ì´ê±´ ì„œë¹„ìŠ¤ì— `synchronized` í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•œ í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ì´ë‹¤.

![test_result_synchronized](https://github.com/user-attachments/assets/c28f265e-1a74-4332-b927-e4cc90891f2f)

ê²°ê³¼ê°€ ë” ì•ˆì¢‹ìŒ ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹

synchronizedì— ëŒ€í•œ ë³´ì™„ì±…ê³¼ ê·¸ ë³´ì™„ì±…ì˜ í•œê³„ì ì€ [ì—¬ê¸°](https://yeongchan1228.tistory.com/145)ì„œ ì˜ ì„¤ëª…í•´ì£¼ì—ˆë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ, í˜„ì¬ ìƒí™©ì— í•„ìš”í•œ ì¡°ê±´ì„ ë‹¨ê¸°ê°„ì˜ ê°œë°œ ì¼ì •ì— ë§Œì¡±í•˜ë ¤ë©´ Pessimistic Lockì´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

<br />

ë§ˆì§€ë§‰ìœ¼ë¡œ, ì´ê±´ Pessimistic Lockì„ ì ìš©í•œ ê²°ê³¼ì´ë‹¤.

![test_result_pm_lock](https://github.com/user-attachments/assets/a640c637-2876-4536-878a-cf3138677d41)

<br />

### ğŸ“Œ API Gatewayì˜ í¸ë¦¬í•œ uri ì„¤ì •

í˜„ì¬ API Gatewayì˜ ë¼ìš°íŒ…ì€ ì´ëŸ°ì‹ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤.

```yaml title=application.yml
spring:
    gateway:
      routes:
        ############## RESERVE-SERVICE ##############
        ######## [reserve-service] REST APIs ########
        - id: reserve-service
          uri: http://localhost:9091 # 2) localhost:9000 ë§ê³  ì—¬ê¸°ë¡œ ë³´ë‚´ì¤Œ
          predicates: # 1) ì—¬ê¸°ë¡œ ì ‘ì† ì‹œë„í•˜ë©´
            - Path=/v2/reserve/**

        ############## COMMON-SERVICE ###############
        ##### [common-service] Public Endpoints #####
        - id: common-service
          uri: http://localhost:9093
          predicates:
            - Path=/, /auth/**, /search, /store, /noti/**, /v1/auth/**, /v1/auth/**, /v1/store/**
          filters:
            - PublicFilter
        ###### [common-service] Member Endpoints #####
        - id: common-service
          uri: http://localhost:9093
          predicates:
            - Path=/member/**, /reserve/**, /v1/member/**, /v1/reserve/**
          filters:
            - MemberAuthFilter
        ###### [common-service] Manager Endpoints #####
        - id: common-service
          uri: http://localhost:9093
          predicates:
            - Path=/store/reserve/**
          filters:
            - ManagerAuthFilter
        ###### [common-service] Admin Endpoints #####
        - id: common-service
          uri: http://localhost:9093
          predicates:
            - Path=/store/registration
          filters:
            - AdminAuthFilter
        ########### static files ##############
        - id: common-service
          uri: http://localhost:9093
          predicates:
            - Path=/css/**, /js/**, /icon/**, /img/**
```

ì´ëŸ¬í•œ ì„¤ì •ì˜ ë¬¸ì œë¼ë©´, ì¶”í›„ í¬íŠ¸ê°€ ë°”ë€Œë©´ ì‚¬ì´ë“œ ì´í™íŠ¸ ê±¸ë¦´ í™•ë¥ ì´ ë†’ë‹¤ëŠ” ì ì´ë‹¤.

ë¬¼ë¡  í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ ë‹¤ ê±¸ë¦¬ê² ì§€ë§Œ ìœ ì§€ë³´ìˆ˜í•˜ê¸° ë³´í†µ ê·€ì°®ì€ê²Œ ì•„ë‹ˆë‹¤.

ê·¸ëŸ¼ ì–´ë–»ê²Œ í•˜ëŠëƒ? ì‚¬ì‹¤ API GatewayëŠ” Service Discoveryì— ë“±ë¡ëœ ì„œë¹„ìŠ¤ëª…ìœ¼ë¡œ urië¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì„ ì§€ì›í•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì´ëŸ°ì‹ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.

```yaml title=application.yml
spring:
    gateway:
      routes:
        ############## RESERVE-SERVICE ##############
        ######## [reserve-service] REST APIs ########
        - id: reserve-service
          uri: lb://RESERVE-SERVICE # 2) localhost:9000 ë§ê³  ì—¬ê¸°ë¡œ ë³´ë‚´ì¤Œ
          predicates: # 1) ì—¬ê¸°ë¡œ ì ‘ì† ì‹œë„í•˜ë©´
            - Path=/v2/reserve/**

        ############## COMMON-SERVICE ###############
        ##### [common-service] Public Endpoints #####
        - id: common-service
          uri: lb://COMMON-SERVICE
          predicates:
            - Path=/, /auth/**, /search, /store, /noti/**, /v1/auth/**, /v1/auth/**, /v1/store/**
```

ê·¸ë˜ì„œ ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ Nginx ì•ˆì“°ëƒê³  ë§ˆë¥´ê³  ë‹³ë„ë¡ ë“¤ì—ˆëŠ”ë°, ì“¸ í•„ìš”ë¥¼ ëª»ëŠë¼ê² ë‹¤.


<br />

### ğŸ“Œ latest í•˜ì§€ ì•Šì€ latest

`1.0.0-beta.6`ì„ ë¦´ë¦¬ì¦ˆí•œ í›„, https ì„¤ì • ë•Œë¬¸ì— ë¨¼ì € http ìª½ì— ì´ìƒì´ ì—†ëŠ”ì§€ í™•ì¸í•˜ë ¤ í–ˆë‹¤.

ê·¼ë° 404ê°€ ë–´ë‹¤. ã…‡ã„´

![404_page](https://github.com/user-attachments/assets/0609d9a3-ea38-4f74-9646-e58f8eeb2db1)

ì²˜ìŒì—ëŠ” docker network í™˜ê²½ì„ ì˜ì‹¬í–ˆë‹¤. ë¼ìš°íŒ… urië¥¼ ê·¸ëƒ¥ localhostë¼ê³  ì¨ë†¨ìœ¼ë‹ˆ...

ì•„ë§ˆ compose ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¡°ì •í•´ì£¼ë©´ ë  ê²ƒì´ë¼ê³  ìƒê°í–ˆë‹¤. í•˜ì§€ë§Œ *ì € ë§ì€ routeë¥¼ ë‹¤ ì–´ë–»ê²Œ?* ë¼ëŠ” ì˜ë¬¸ì´ ë“¤ì—ˆë‹¤.

ì´ë¥¼ ì•Œì•„ë³´ê¸° ìœ„í•´ ì´ê³³ì €ê³³ ë ˆí¼ë¥¼ ì°¾ì•„ë´¤ëŠ”ë°, ê²°êµ­ì—” ê·¸ëƒ¥ [ëˆ„ê°€ ê¹ƒí—ˆë¸Œì— ì˜¬ë ¤ë†“ì€ ì½”ë“œ](https://github.com/BarathArivazhagan/spring-cloud-gateway-routing/blob/master/docker-compose.yml)ì—ì„œ í•´ë‹µì„ ì–»ì—ˆë‹¤.

ë¬¸ë²•ì´ ì¢€ íŠ¹ì´í•˜ë”ë¼.

<br />

#### ğŸ˜‰ ì‘ ì „ë¶€ ë‹¤ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì¨

![Image](https://github.com/user-attachments/assets/d7a9e88c-2533-42e1-aaa8-e11c2e2b13f1)

ê·¼ë° ê·¸ëŒ€ë¡œ ì ìš©í•˜ê³  ë°°í¬í–ˆì„ë•Œ ê²Œì´íŠ¸ì›¨ì´ê°€ í„°ì ¸ìˆê¸¸ë˜ ë¡œì»¬ì—ì„œ compose upìœ¼ë¡œ ë¡œê·¸ë¥¼ ì‚´í´ë³´ì•˜ë‹¤.


![Image](https://github.com/user-attachments/assets/75abe3cc-7893-4b42-9d1b-cdc623fbe127)

predicatesê°€... ì™œ ë‚ ë¼ê°„ê±°ì§€;?

![Image](https://github.com/user-attachments/assets/af9b9689-d7a4-494e-9a6c-765d9aaa6a05)

*(ì°¸ê³ ë¡œ ì €ê²Œ localeì„ ë”°ë¼ê°€ì„œ IDEAì—ì„  í•œêµ­ì–´ ë¡œê·¸ë¥¼ ë„ì›Œì¤Œ. ê·€ì—½ë‹¤ ã…‹ã…‹)*

<br />

ê²°êµ­ ì´ëŸ°ì‹ìœ¼ë¡œ ë…¸ê°€ë‹¤í•´ì£¼ë‹ˆê¹Œ í„°ì§€ì§„ ì•Šì•˜ë‹¤.

í•˜ì§€ë§Œ ì´ ë…¸ê°€ë‹¤ë¥¼ ì“°ëŠë‹ˆ ê·¸ëƒ¥ ë¡œì»¬ì—ì„œë„ lb://~ ê°€ ë‚˜ì€ë° ë¡œì»¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ êµì²´í•˜ëŠ”ê²Œ ë‚«ê² ë‹¤.

ê·¸ë¦¬ê³  ì–˜ë„ í…ŒìŠ¤íŠ¸í•˜ë‹ˆê¹Œ ì—¬ì „íˆ 404ì˜€ë‹¤.

```yaml title=compose.yml
services:
    api-gateway:
        environment:
            eureka.client.serviceUrl.defaultZone: http://service-discovery:8761/eureka
            SPRING_CLOUD_GATEWAY_ROUTES[0]_URI: lb://RESERVE-SERVICE
            SPRING_CLOUD_GATEWAY_ROUTES[0]_PREDICATES[0]: Path=/v2/reserve/**
            SPRING_CLOUD_GATEWAY_ROUTES[1]_URI: lb://COMMON-SERVICE
            SPRING_CLOUD_GATEWAY_ROUTES[1]_PREDICATES[0]: Path=/
            SPRING_CLOUD_GATEWAY_ROUTES[1]_PREDICATES[1]: Path=/auth/**
            SPRING_CLOUD_GATEWAY_ROUTES[1]_PREDICATES[2]: Path=/search
            SPRING_CLOUD_GATEWAY_ROUTES[1]_PREDICATES[3]: Path=/store
            SPRING_CLOUD_GATEWAY_ROUTES[1]_PREDICATES[4]: Path=/noti/**
            SPRING_CLOUD_GATEWAY_ROUTES[1]_PREDICATES[5]: Path=/v1/auth/**
            SPRING_CLOUD_GATEWAY_ROUTES[1]_PREDICATES[6]: Path=/v1/store/**
            SPRING_CLOUD_GATEWAY_ROUTES[2]_URI: lb://COMMON-SERVICE
            SPRING_CLOUD_GATEWAY_ROUTES[2]_PREDICATES[0]: Path=/member/**
            SPRING_CLOUD_GATEWAY_ROUTES[2]_PREDICATES[1]: Path=/reserve/**
            SPRING_CLOUD_GATEWAY_ROUTES[2]_PREDICATES[2]: Path=/v1/member/**
            SPRING_CLOUD_GATEWAY_ROUTES[2]_PREDICATES[3]: Path=/v1/reserve/**
            SPRING_CLOUD_GATEWAY_ROUTES[3]_URI: lb://COMMON-SERVICE
            SPRING_CLOUD_GATEWAY_ROUTES[3]_PREDICATES[0]: Path=/store/reserve/**
            SPRING_CLOUD_GATEWAY_ROUTES[4]_URI: lb://COMMON-SERVICE
            SPRING_CLOUD_GATEWAY_ROUTES[4]_PREDICATES[0]: Path=/store/registration
            SPRING_CLOUD_GATEWAY_ROUTES[5]_URI: lb://COMMON-SERVICE
            SPRING_CLOUD_GATEWAY_ROUTES[5]_PREDICATES[0]: Path=/css/**
            SPRING_CLOUD_GATEWAY_ROUTES[5]_PREDICATES[1]: Path=/js/**
            SPRING_CLOUD_GATEWAY_ROUTES[5]_PREDICATES[2]: Path=/icon/**
            SPRING_CLOUD_GATEWAY_ROUTES[5]_PREDICATES[3]: Path=/img/**
```

<br />

#### ğŸ™„ ëŒ€ì²´ ë­ê°€ ë¬¸ì œì•¼

ê²°êµ­ 9093ë²ˆ í¬íŠ¸ ì¸ë°”ìš´ë“œë¥¼ ì—´ì–´ì„œ ê¹Œë´¤ëŠ”ë°, common-service ìì²´ê°€ 404ì˜€ë‹¤.

...ë¼ìš°íŒ…ì€ ë¨¹í˜”ë˜ ê²ƒì´ë‹¤.

404ê°€ ëœ¬ë‹¤ëŠ” ê²ƒì€ íƒ€ì„ë¦¬í”„ í…œí”Œë¦¿ì´ ì—†ë‹¤ëŠ”ê±´ë° ì´ê²Œ CORSë¡œ í„°ì¡Œì„ë¦¬ë„ ì—†ê³  ì§„ì§œ íŒŒì¼ì´ ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ì— ì—†ì„ë¦¬ë„ ì—†ê³ 

ê³°ê³°íˆ ìƒê°í•˜ë‹¤ê°€ í˜„ì¬ ë°°í¬ëœ ì´ë¯¸ì§€ê°€ ê°œë°œ ì´ˆê¸° ë²„ì „ì—ì„œ ì—…ëƒì´ ì•ˆëœê±¸ìˆ˜ë„ ìˆê² ë‹¤ëŠ” ì˜ì‹¬ì´ ë¹¡ ë“¤ì—ˆë‹¤.

ê·¸ë¦¬ê³  [ì´ ë ˆí¼ëŸ°ìŠ¤](https://stackoverflow.com/a/56838574)ì—ì„œ ë˜‘ê°™ì€ ë§ì„ í•˜ê³  ìˆë‹¤.

>Best practice is generally to be explicit in your `docker run` and similar commands: use a unique tag for every image build (like a date stamp, source control commit ID, or build number), use that specific version/build number when youâ€™re deploying, and **donâ€™t rely on things like the `latest` tag.**

>The trick here is that if you `docker run someimage:latest`, Docker first starts by looking at its local list of images. If it already has something with that exact name and tag, it just runs it; if not, it will implicitly `docker pull` first. This extends to higher-level orchestration systems too (you have to go fairly far out of your way to get Kubernetes to force it to reload an image, for example).

ì•„. ë­”ê°€ ì˜ˆì „ë¶€í„° ì»¨í…Œì´ë„ˆ ë²„ì „ ë‚˜ëˆ ì•¼ í•˜ì§€ ì•Šë‚˜ í•˜ê³  ì‹ ê²½ì“°ì˜€ë˜ê²Œ ì‹œê°„ ì—†ì–´ì„œ ë„˜ì–´ê°”ëŠ”ë° ìŠ¤ë…¸ìš°ë³¼ì´ ë˜ì–´ì„œ ëŒì•„ì˜´

ìˆ˜ë™ ë°°í¬í•´ë³´ë‹ˆê¹Œ ì„œë¹„ìŠ¤ ì˜ ëœ¨ë”ë¼.

ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹

ê·¸ë˜ì„œ ìˆ˜ë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê¸‰í•˜ê²Œ ë§Œë“¤ê¹Œ ë§ê¹Œ í•˜ë‹¤ê°€, ê·¸ëƒ¥ CIë¥¼ 1ì°¨ì ìœ¼ë¡œ ê³ ì¹˜ê¸°ë¡œ í–ˆë‹¤.

ì´ìƒì ì¸ê±´ ë‚´ê°€ ìš”ì¦˜ ìê¾¸ gradleì—ì„œ í”„ë¡œì íŠ¸ ë²„ì „ì—…ì„ ê¹Œë¨¹ìœ¼ë‹ˆê¹Œ ì´ê±¸ í‹€ì–´ë§‰ëŠ”ê±°ë‘

ì˜¥í† í‚·ìœ¼ë¡œ ì»¤ë°‹ íŒŒì‹±í•´ì„œ ìë™ìœ¼ë¡œ CIì— ë³€ê²½ëœ ë²„ì „ ë°˜ì˜í•˜ëŠ”ê±´ë°...

ì‹œê°„ì´ ì—†ìœ¼ë‹ˆ ë¦´ë¦¬ì¦ˆë§ˆë‹¤ CIë¥¼ ê°™ì´ ìˆ˜ì •í•´ì£¼ê¸°ë¡œ í•˜ê³ , ë²„ì „ ë“¤ì–´ê°€ëŠ” ë¶€ë¶„ì„ ë”°ë¡œ ë³€ìˆ˜í™”í•´ì„œ 1ì°¨ë¼ê³  ì¹­í•˜ê² ë‹¤.

ê·¸ë‚˜ì €ë‚˜ ì´ê±°ë•Œë¬¸ì— ì˜¤ëŠ˜ ELB ì„¸íŒ… ëª»í•¨. ì‹¤í™”ëƒ?